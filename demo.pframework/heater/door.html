<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Door angle</title>
  </head>
  <body>
    <h1>Door angle detector</h1>

    <script src="https://app.protobject.com/framework/p.js?1"></script>
    <script src="config.js"></script>

    <script>
      
      // Inicia la captura de datos de orientación cada 30 ms
      Protobject.Orientation.start(30);
      const player = new Protobject.SoundPlayer(); // Crea una instancia del reproductor de sonido
      
      let previousAngle = null; // Variable para almacenar el ángulo anterior

      // Escucha los datos de orientación
      Protobject.Orientation.onData(({ horizontalContinuous }) => {
        const currentAngle = parseInt(horizontalContinuous); // Convierte el ángulo a un número entero

        // Compara el ángulo actual con el anterior y verifica si está dentro de un rango específico
        if (currentAngle !== previousAngle && Math.abs(currentAngle) < 90) {
          Protobject.Core.send(Math.abs(currentAngle)).to("index.html"); // Envía el ángulo actual a 'graph.js'
          previousAngle = currentAngle; // Actualiza el ángulo anterior
          console.log(currentAngle); // Muestra el ángulo actual en la consola
        }

        // Reproduce un sonido si el ángulo actual excede un umbral
        if (Math.abs(currentAngle) > 4) {
          player.play(
            "https://cdn.freesound.org/previews/145/145805_1218676-lq.mp3",
            true
          ); // Reproduce el sonido
        } else {
          player.stop(); // Detiene la reproducción si el ángulo está por debajo del umbral
        }
      });
      
	
    </script>
  </body>
</html>
